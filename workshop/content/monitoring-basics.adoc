## OpenShift Monitoring
このラボでは、OpenShift Monitoring　機能のさまざまな側面を探ります。
これには、OpenShift Alertmanager UI の概要、Prometheus ウェブコンソールへのアクセス、PromQL (Prometheuses Query Language) クエリの実行によるクラスタの検査、最後に Grafana ダッシュボードの確認が含まれます。

### OpenShift Monitoring

OpenShift Container Platformには、Prometheusオープンソースプロジェクトとその広範なエコシステムをベースにした、設定済み、プリインストール済み、自己更新型の監視スタックが含まれています。
これはクラスタコンポーネントの監視を提供し、発生した問題をクラスタ管理者に即座に通知する一連のアラートと一連の Grafana ダッシュボードが含まれています。
クラスタ監視スタックは、OpenShift Container Platform クラスタの監視にのみサポートされています。

#### Examine Alerting Configuration

1. リンク先:{{MASTER_URL }}[OpenShift Web Console]にkubeadminの資格情報でログインします。
+
[source,role="copypaste"]
----
kubeadmin
----
+
[source,role="copypaste"]
----
{{ KUBEADMIN_PASSWORD }}
----
+
[WARNING]
====
OpenShift の Web コンソールに最初にアクセスすると、ブラウザに自己署名証明書のエラーが表示されます。
OpenShift をインストールすると、デフォルトでは、Web コンソールを含む OpenShift 内のすべてのコンポーネント間通信に対して CA 証明書と SSL 証明書が生成されます。
====
+
1. 左側の「Monitoring」ドロップダウンをクリックします。
1. 「Alerting」をクリックします。OpenShift コンソールのアラート設定の表示です。

「Alerting」タブには、現在設定されているアラートおよび/またはアクティブなアラートに関する情報が表示されます。
を見たり、いくつかのことをすることができます。:

1. アラートを名前でフィルタリングします。
1. 状態によってアラートをフィルタリングします。発火するためには、いくつかのアラートはタイムアウトの間、特定の条件が true である必要があります。アラートの条件が現在 true であるが、タイムアウトに達していない場合、そのようなアラートは保留状態になります。
1. アラート名。
1. アラートの内容。
1. 現在のアラートの状態とアラートがいつこの状態になったか。
1. アラートの深刻度ラベルの値。
1. アラートでできるアクション。

また、このページの上部にあるリンクをクリックして、直接 Alertmanager UI に入ることもできます。

##### Metrics UI (Prometheus Console)
アラート画面に加えて、OpenShift のビルトインモニタリングでは、Prometheus が収集したメトリクスにアクセスするためのインターフェイスを提供しています:https://prometheus.io/docs/prometheus/latest/querying/basics/[Prometheus
クエリ言語（PromQL）].

1.OpenShift Console の左側の「Monitoring」セクションで、「Metrics」のリンクをクリックします。

##### Running Prometheus Queries
クエリを実行して、すべてのポッド定義で定義されているリソースのメモリ制限を確認してみましょう。

1. 次のクエリをコピーして、式のテキストボックスに貼り付けます。:
+
[source,role="copypaste"]
----
sum(kube_pod_container_resource_limits_memory_bytes)/(1024^3)
----
+
1. "Run Queries" をクリックします。
1. You should now see a timeseries with a value in the list. This value is
  the latest gathered value for the timeseries as defined by this query.
  You will also see a graph showing the value over the last time period (defaults to 30m).

これで、リストの中に値を持つ時系列が表示されるはずです。この値は、このクエリで定義された時系列の最新の値です。
  また、過去の期間の値を示すグラフも表示されます（デフォルトは30m）。



Now let's run a query to see the cpu usage for the entire cluster.

1. Click "Add Query"
1. Copy and paste the following query into the query text box:
+
[source,role="copypaste"]
----
cluster:cpu_usage_cores:sum
----
+
1. Click the "Run Queries" button
1. You should now see a timeseries with a value in the list. This value is
  the latest gathered value for the timeseries as defined by this query.
  You'll also see that your new query got plotted on the same graph.

The metrics interface lets you run powerful queries on the information
collected about your cluster.

You'll also note that you can click directly into the Prometheus UI with a
link that's at the top of this page.

##### Dashboards UI (Grafana)
In addition to the Metrics UI, OpenShift monitoring provides a preconfigured
"Dashboards" UI (aka "Grafana"). The purpose of these Dashboards is to show
multiple metrics in easy to consume form graphed over time.

1. Click the "Dashboards" link under the "Monitoring" section on the left hand side.
+
[WARNING]
====
You will receive a self-signed certificate error in your browser when you
first visit the Dashboards UI console. When OpenShift is installed, by default, a CA
and SSL certificates are generated for all inter-component communication
within OpenShift, including the Grafana dashboard.
====
+
1. Click "Log in with OpenShift" button.
1. Click "kube:admin" if the option is provided.
+
[source,role="copypaste"]
----
kubeadmin
----
+
[source,role="copypaste"]
----
{{ KUBEADMIN_PASSWORD }}
----
+
1. On the "Authorize Access" page, click the "Allow selected permissions" button.
1. This is the Grafana "Home Dashboard" page.
1. Click on the "Home" dropdown at the top of the page
1. Select the "Kubernetes / Compute Resources / Cluster" dashboard.
  The "Kubernetes / Compute Resources / Cluster" dashbard shows an overview
  of the resources currently committed and actively being used by the
  cluster.
+
.Dashboards UI (Grafana)
image::images/grafana_dashboard.png[]
